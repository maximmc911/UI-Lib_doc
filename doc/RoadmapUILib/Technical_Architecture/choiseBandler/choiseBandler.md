

[назад](../Technical_Architecture.md)


# Документация по бандлерам в разработке UI-библиотеки

---

## 1. Что такое бандлер?

**Бандлер** (bundler) — это инструмент для сборки JavaScript-приложений и библиотек, который объединяет множество исходных файлов (модули, стили, изображения и прочее) в один или несколько оптимизированных файлов для использования в браузере.

Задачи бандлера:
- Объединение модулей в один файл (или несколько файлов).
- Трансформация современных стандартов JS (ESModules, TypeScript) в код, поддерживаемый браузерами.
- Минификация и оптимизация кода.
- Обработка CSS, изображений и других ресурсов.
- Разделение кода (code splitting) для ускорения загрузки.
- Поддержка горячей перезагрузки (hot reload) при разработке.

Бандлеры значительно упрощают и ускоряют процесс разработки и деплоя фронтенд-проектов.

---

## 2. Популярные бандлеры и их сравнение

| Название       | Основные особенности                                   | Скорость сборки | Размер итогового бандла | Поддержка TS/JSX | Поддержка CSS и ассетов | Code Splitting | Сообщество / Документация | Особенности                      |
|----------------|--------------------------------------------------------|-----------------|------------------------|------------------|------------------------|----------------|---------------------------|---------------------------------|
| **Webpack**    | Очень гибкий, мощный, огромная экосистема плагинов     | Средняя         | Оптимизированный       | Да               | Да                     | Да             | Очень большое             | Сложность конфигурации           |
| **Rollup**     | Оптимален для библиотек, компактный, tree shaking      | Быстрая         | Очень компактный       | Да               | Да                     | Да             | Среднее                   | Лучше всего подходит для библиотек|
| **Vite**       | Быстрая сборка и dev server, использует Rollup для билда| Очень высокая   | Оптимизированный       | Да               | Да                     | Да             | Быстро растущее           | Современный, простой в настройке |
| **Parcel**     | Конфигурирование практически не требуется               | Быстрая         | Оптимизированный       | Да               | Да                     | Да             | Среднее                   | Легкий старт, минимальная настройка |
| **esbuild**    | Очень высокая скорость, минимальная функциональность    | Очень высокая   | Компактный             | Да (ограниченно)  | Да                     | Ограничена     | Растущее                  | Используется как сборщик и бандлер|
| **Snowpack**   | Dev server с нативной поддержкой ES модулей            | Очень высокая   | Зависит от конфигурации| Да               | Да                     | Да             | Небольшое                 | Переходит на Vite в большинстве случаев |

---

## 3. Какой бандлер оптимально выбрать для создания UI-библиотеки?

### Основные критерии выбора:
- **Оптимизация размера итогового пакета** — библиотека должна быть компактной.
- **Поддержка tree-shaking** — для исключения неиспользуемого кода.
- **Поддержка TypeScript и JSX** — современные технологии разработки.
- **Простота конфигурации** — чтобы не тратить много времени на настройку.
- **Поддержка различных форматов стилей и ассетов** — для гибкости.
- **Гибкость и масштабируемость** — возможность легко расширять библиотеку и поддерживать разные фреймворки.

### Рекомендация:

- **Rollup** — часто используется для сборки UI-библиотек, так как умеет эффективно «трясти» неиспользуемый код (tree-shaking), генерирует компактные пакеты и отлично поддерживает ESModules.
- **Vite** — современный инструмент на основе Rollup, удобен для разработки и сборки, быстро настраивается и обеспечивает хорошую производительность.
- **Webpack** — подходит для сложных проектов и когда требуется максимальная гибкость, но конфигурация может быть громоздкой.

---

## 4. Как использовать бандлеры — простые примеры

### 4.1 Использование Rollup

**Установка:**

```bash
npm install --save-dev rollup @rollup/plugin-node-resolve @rollup/plugin-commonjs rollup-plugin-typescript2
````

**Конфигурация `rollup.config.js`:**

```js
import resolve from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import typescript from 'rollup-plugin-typescript2';

export default {
  input: 'src/index.tsx',  // входная точка
  output: [
    {
      file: 'dist/bundle.cjs.js',
      format: 'cjs',
    },
    {
      file: 'dist/bundle.esm.js',
      format: 'esm',
    },
  ],
  plugins: [
    resolve(),
    commonjs(),
    typescript({ tsconfig: './tsconfig.json' }),
  ],
  external: ['react', 'react-dom'], // исключаем peer-зависимости
};
```

**Запуск сборки:**

```bash
npx rollup -c
```

---

### 4.2 Использование Vite

**Установка:**

```bash
npm init vite@latest my-ui-lib -- --template react-ts
cd my-ui-lib
npm install
```

**Запуск dev-сервера:**

```bash
npm run dev
```

**Сборка:**

Для библиотеки можно создать отдельный скрипт в `vite.config.ts` с форматом сборки библиотеки:

```ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  build: {
    lib: {
      entry: 'src/index.ts',
      name: 'MyUILibrary',
      fileName: (format) => `my-ui-lib.${format}.js`,
    },
    rollupOptions: {
      external: ['react', 'react-dom'],
      output: {
        globals: {
          react: 'React',
          'react-dom': 'ReactDOM',
        },
      },
    },
  },
});
```

Запускаем сборку:

```bash
npm run build
```

---

### 4.3 Использование Webpack

**Установка:**

```bash
npm install --save-dev webpack webpack-cli ts-loader css-loader style-loader
```

**Пример `webpack.config.js`:**

```js
const path = require('path');

module.exports = {
  entry: './src/index.tsx',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
    library: 'MyUILibrary',
    libraryTarget: 'umd',
    globalObject: 'this',
  },
  resolve: {
    extensions: ['.tsx', '.ts', '.js'],
  },
  externals: {
    react: 'react',
    'react-dom': 'react-dom',
  },
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/,
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
    ],
  },
};
```

**Запуск сборки:**

```bash
npx webpack --mode production
```

---

## 5. Какой бандлер лучше использовать при планах расширения поддержки нескольких фреймворков и библиотек?

Если в будущем планируется расширять UI-библиотеку, добавляя поддержку не только React, но и Vue, Next.js, Nuxt.js, нативного JavaScript и других технологий, крайне важно выбрать бандлер, который обеспечит:

* **Гибкую и масштабируемую конфигурацию**, чтобы легко адаптировать сборку под разные платформы и форматы.
* **Поддержку нескольких входных точек (entry points)**, чтобы можно было собирать версии библиотеки под разные фреймворки.
* **Поддержку различных форматов вывода** (CommonJS, ESM, UMD), чтобы библиотека была совместима с различными экосистемами.
* **Возможность интеграции с современными dev tools и средами** для удобной разработки и поддержки.

### Почему именно Rollup или Vite?

* **Rollup** отлично подходит для создания UI-библиотек с мульти-фреймворковой поддержкой благодаря своей архитектуре плагинов и возможности создавать несколько выходных форматов. Он широко используется в open-source для сборки кросс-фреймворковых библиотек.

* **Vite** — современный инструмент, построенный на базе Rollup, с быстрой сборкой и встроенной поддержкой React и Vue из коробки. Он облегчает разработку, ускоряет итерации и легко расширяется под разные фреймворки.

### Почему не Webpack?

* Хотя Webpack невероятно гибок и мощен, его конфигурация часто усложняется с ростом проекта и числа поддерживаемых платформ.
* Вебпак может привести к более долгому времени сборки и сложностям поддержки при многоплатформенной разработке UI-библиотеки.

### Итог

| Критерий                         | Rollup   | Vite            | Webpack       |
| -------------------------------- | -------- | --------------- | ------------- |
| Масштабируемость                 | Отличная | Отличная        | Хорошая       |
| Поддержка нескольких фреймворков | Да       | Да              | Да            |
| Простота настройки               | Средняя  | Очень простая   | Сложная       |
| Скорость сборки (dev и prod)     | Быстрая  | Очень быстрая   | Средняя       |
| Поддержка TypeScript и JSX       | Да       | Да              | Да            |
| Сообщество и экосистема          | Большая  | Быстро растущая | Очень большая |

---

## Заключение

Для UI-библиотеки, рассчитанной на расширение с поддержкой React, Vue, Next.js, Nuxt.js и нативного JS, рекомендуется начинать с **Rollup** или **Vite**. Они обеспечивают оптимальный баланс между производительностью, удобством разработки и возможностью масштабирования.

* Начинайте с **React + Rollup/Vite** — это обеспечит стабильную базу и оптимальный размер бандла.
* По мере роста проекта добавляйте отдельные сборочные конфигурации для Vue, Next.js и других платформ.
* Используйте единый набор утилит и конвенций для максимально простого расширения.

Если в будущем понадобится интеграция со сложными настройками и уникальными требованиями — можно рассмотреть Webpack, но для UI-библиотеки с мультифреймворковой поддержкой Rollup и Vite — это более современный и удобный выбор.

---

Если нужны примеры конфигураций для мультифреймворкового билда — могу подготовить их отдельно.

```
```
